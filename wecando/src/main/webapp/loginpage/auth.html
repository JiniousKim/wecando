<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Wecando</title>

<!-- Bootstrap core CSS -->
<link rel="stylesheet" href="../css/bootstrap.css">
<!--external css-->
<link rel="stylesheet" href="../lib/font-awesome/css/font-awesome.css" />
<link rel="stylesheet" type="text/css"
  href="../js/gritter/css/jquery.gritter.css" />
<link rel="stylesheet" type="text/css" href="../lineicons/style.css">

<!-- Custom styles for this template -->
<link href="../css/list.css" rel="stylesheet">
<link href="../css/style.css" rel="stylesheet">
<link href="../css/style-responsive.css" rel="stylesheet">
<link rel="shortcut icon" type="image/x-icon" href="../img/logo.png" />
<script src="../js/chart-master/Chart.js"></script>

<link rel="stylesheet" type="text/css"
  href="../lib/sweetalert/sweetalert.css">

<script src='../js/dj_check.js' type="text/javascript"></script>
</head>
<body>
	<section id="container" class="sidebar-closed">
		<header class="header black-bg">
			<div class="sidebar-toggle-box">
				<div class="fa fa-bars tooltips" data-placement="right"
					data-original-title="Toggle Navigation"></div>
			</div>
			<a href="../wecando.html" class="logo"> <img id="wecando_white"
				src="../img/wecando_white.png">
			</a>
		</header>
		<aside>
			<div id="sidebar" class="nav-collapse">
        <ul class="sidebar-menu" id="nav-accordion">
          <li class="sub-menu"><a href="javascript:;"> <i
              class="fa fa-calendar"></i> <span>예약 정보</span>
          </a>
            <ul class="sub" id='sub_m'>
              <li><a href="../info/ClientCurrentReserveList.html">내 예약정보</a></li>
              <li><a href="../info/ClientLastList.html">지난 예약정보</a>
            </ul></li>

          <li class="sub-menu"><a href="javascript:;"> <i
              class="fa fa-user"></i> <span>마이 페이지</span>
          </a>
            <ul class="sub" id='sub_menu'>
              <li><a href="../info/memberInfo.html">내 정보</a></li>
            </ul></li>
        </ul>
      </div>
		</aside>
		<section id="main-content">
			<section class="wrapper">
				<div id="auth">
					<img id="joinus" src="../img/joinus.png">
					<!-- INLINE FORM ELELEMNTS -->
					<div class="row mt">
						<div class="col-lg-12">
							<div class="form-panel-email">
								<h1 class="email">
									<i class="fa fa-angle-right"></i> 이메일 인증
								</h1>
								<div class="form-inline" role="form">
									<p>이메일을 입력하고 인증하기를 눌러 해당 이메일로 전송된 링크를 클릭하면 회원가입을 진행하실 수
										있습니다.</p>
									<div id='m_eForm' class="form-group2 has-feedback">
										<label class="sr-only" for="m_e">Email address</label> <input
											type="text" class="form-control" id="m_e" name='m_e'
											onchange="check(this.id);" placeholder="Enter email"
											style="width: 300px;">
										<button type="submit" class="btn1" id="btn-auth">인증하기</button>
										<div class="control-label" id="m_eMsg" style="display: none;">이메일
											형식이 아닙니다.</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</section>
	</section>
	<script src="../js/jquery.js"></script>
	<script src="../js/bootstrap.min.js"></script>
	<script class="include" type="text/javascript"
		src="../js/jquery.dcjqaccordion.2.7.js"></script>
	<script src="../js/common-scripts.js"></script>
	<script src="../lib/sweetalert/sweetalert.min.js"></script>
	<script>
	  $(document).ready(function() {
	    $.ajax({
        url : contextRoot + '/auth/ajax/check_session.do',
        type : 'post',
        dataType : 'json',
        cache : false,
        processData : false,
        contentType : false,
        async : false,
        success : function(resultObj) {
          var loginAva = $('#login_ava');
          var sM = $('#sub_menu');
          var sub = $('#sub_m');
          var ajaxresult = resultObj;
          m_no = resultObj.m_no;
          if (ajaxresult.status == 'failure') {
              
          } else {
        	    location.replace("http://localhost:8080/wecando/wecando.html");
            loginAva.append("<ul class='nav pull-right top-menu'>"
							              + "<li><a class='logout'"
							              + "href='' onclick='logout();'>Logout</a></li>"
							              + "</ul>")
          } 
          if (ajaxresult.grade == 2) {
              sM.append(
               "<li><a href='register_school.html'>학교 정보</a></li>"   
              )
              sub.append(
              "<li><a href='ClientReserveList.html'>신청된 정보</a></li>"
                )
          }
        }
      })
	  })
		$(document).on("click",'#btn-auth',function(e) {
			var form_data = new FormData();
			form_data.append("m_email", $('#m_e').val())
        if ($('#m_e').val() == '' ||
      		    $('#m_eForm').attr('class') == 'form-group2 has-feedback has-error') {
      	    sweetAlert('Oops...', 'email 형식에 맞지 않습니다.', 'error');
      	    return false;
        } else {
				$.ajax({
					url : contextRoot + '/member/ajax/check_email.do',
					type : 'post',
					dataType : 'json',
					async : false,
					cache : false,
					contentType : false,
					processData : false,
					data : form_data,
					success : function(resultObj) {
						var ajaxResult = resultObj.ajaxResult;
						if (ajaxResult.status == 'success') {
							$.ajax({
								url : contextRoot + '/member/ajax/add.do',
								type : 'post',
								dataType : 'json',
								async : false,
								cache : false,
								contentType : false,
								processData : false,
								data : form_data,
								success : function(resultObj) {
									var ajaxResult = resultObj.ajaxResult;
									console.log(ajaxResult);
									console.log(ajaxResult.status);
									if (ajaxResult.status == 'success') {
										swal("Good job!","Email 전송이 완료되었습니다","success")
									} else {
										sweetAlert("Oops...", "다시 시도해 주세요",	"error");
									}
								}
							});
						} else {
							sweetAlert("Oops...", "중복된 이메일 입니다.", 'error');
						}
					}
				});
      }
		});
	</script>
</body>
</html>
