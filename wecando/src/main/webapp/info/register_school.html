<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="Dashboard">
<meta name="keyword"
  content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

<title>Wecando</title>

<!-- Bootstrap core CSS -->
<link rel="stylesheet" href="../css/bootstrap.css">
<!--external css-->
<link rel="stylesheet" href="../font-awesome/css/font-awesome.css"/>
<link rel="stylesheet" type="text/css" href="../js/gritter/css/jquery.gritter.css" />
<link rel="stylesheet" type="text/css" href="../lineicons/style.css">

<!-- Custom styles for this template -->
<link href="../css/style.css" rel="stylesheet">
<link href="../css/style-responsive.css" rel="stylesheet">

<script src="../js/chart-master/Chart.js"></script>
</head>
<body>

  <div id="login-page">
    <div class="container">
      <!-- Modal -->
      <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog"
        id="myModal1" class="modal fade">
        <form class="form-login">
          <div class="modal-header" style="background-color: #2b4e55;">
            <h2 style="background-color: #2b4e55;" class="form-login-heading">sign
              in now</h2>
          </div>
          <div class="login-wrap">
            <div class="input-ikon">
              <i class='fa fa-user sc'></i>
            </div>
            <input type="text" id="m_email" class="f-c i-t"
              placeholder="User ID" autofocus> <br>
            <div class='input-ikon2'>
              <i class='fa fa-lock sc'></i>
            </div>
            <input type="password" id="m_password" class="f-c i-t"
              placeholder="Password">
            <div style='margin-top: 30px;'>
              <div class='b-s'>
                <button class="btn btn-block bh" type="button"
                  onclick="login();">LOGIN</button>
              </div>
              <div class="b-s1">
                <button type='button' class="btn bh btn-block" onclick="join();">SIGN
                  UP</button>
              </div>
              <hr>
            </div>
          </div>
        </form>
      </div>
      <!-- modal -->
    </div>
  </div>

  <!-- School Search -->
  <div class="search_school">
    <!-- School Search -->
    <div class="modal fade" id="search_school" tabindex="-1" role="dialog"
      aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="myModalLabel">학교 검색</h4>
          </div>
          <div class="modal-body">
              <form onsubmit="searchPlaces(); return false;">
                    <input type="text" class="form-control col-sm-3 inputbox" id="sch_name">
                  <button id="searchBtn" type="submit" class="btn btn-default" onclick="search();">검색</button>
                </form>  
            <div class="col-lg-10">
              <p class="form-control-static" style="color: #777; margin-top: 10px">검색 결과</p>
                <div id="map1">
                </div>
            </div>
          </div>
          <div class="modal-foot">
            <button type="button" class="btn btn-primary">확인</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">취소</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- /school_search -->

  <section id="container" class="sidebar-closed">
    <header class="header black-bg">
      <div class="sidebar-toggle-box">
        <div class="fa fa-bars tooltips" data-placement="right"
          data-original-title="Toggle Navigation"></div>
      </div>
      <a href="wecando.html" class="logo"> <img id="wecando_white"
        src="../img/wecando_white.png">
      </a>
      <div class="top-menu">
        <ul class="nav pull-right top-menu">
          <li><a class="logout" data-toggle="modal"
            href="../wecando.html#myModal1">Logout</a></li>
        </ul>
      </div>
    </header>
    <aside>
      <div id="sidebar" class="nav-collapse ">
        <ul class="sidebar-menu" id="nav-accordion">
          <li class="sub-menu"><a href="../javascript:;"> <i
              class="fa fa-calendar"></i> <span>예약 정보</span>
          </a>
            <ul class="sub">
              <li><a href="general.html">General</a></li>
              <li><a href="buttons.html">Buttons</a></li>
              <li><a href="panels.html">Panels</a></li>
            </ul></li>

          <li class="sub-menu"><a href="../javascript:;"> <i class="fa fa-user"></i> <span>마이
                페이지</span>
          </a>
            <ul class="sub">
              <li><a href="memberInfo.html">내 정보</a></li>
              <li><a href="../gallery.html">Gallery</a></li>
              <li><a href="../todo_list.html">Todo List</a></li>
            </ul></li>
        </ul>
      </div>
    </aside>
    <section id="main-content">
      <section class="wrapper">
        <div id="auth">
          <img id="joinus" src="../img/register.png">
          <!-- INLINE FORM ELELEMNTS -->

          <div class="row mt">
            <div class="col-lg-12">
              <div class="form-panel-email">
                <form class="form-horizontal style-form" method="get">
                  <div class="form-group">
                    <label class="col-lg-2 col-sm-2 control-label" style="font-weight: bold;">
                      관리 담당 학교</label>
                    <div class="col-lg-10">
                      <button type="button" class="btn btn-default" style="margin: 0px;"
                        data-toggle="modal" data-target="#search_school">학교 검색하기</button>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-lg-2 col-sm-2 control-label"> 학교 이름</label>
                    <div class="col-lg-10">
                      <p class="form-control-static " style="color: #777;">학교 이름 받아오기</p>
                    </div>
                    <label class="col-lg-2 col-sm-2 control-label"> 학교 위치</label>
                    <div class="col-lg-10">
                      <p class="form-control-static" style="color: #777;">학교 위치 받아오기</p>
                    </div>
                    <label class="col-lg-2 col-sm-2 control-label"> 전화번호</label>
                    <div class="col-lg-10">
                      <p class="form-control-static" style="color: #777;">학교 전화번호 받아오기</p>
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="form-group1">
                      <label class="col-sm-2 col-sm-2 control-label" style="font-weight: bold;">
                        시설물 등록</label>
                    </div>
                    <label class="col-sm-2 col-sm-2 control-label"> 이용가능 종목</label>
                    <div class="col-sm-10">
                      <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle"
                          data-toggle="dropdown">
                          종목 <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                          <li><a href="#">수영</a></li>
                          <li><a href="#">농구</a></li>
                          <li><a href="#">축구</a></li>
                        </ul>
                      </div>
                    </div>
                    <label class="col-sm-2 col-sm-2 control-label"> 코트 수</label>
                    <div class="col-sm-10">
                      <form>
                        Quantity: <input type="number" name="points" min="0" max="100" step="10"
                          value="30">
                      </form>
                    </div>
                    <label class="col-sm-2 col-sm-2 control-label"> 최대 수용 인원</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control col-sm-3">
                    </div>
                    <label class="col-sm-2 col-sm-2 control-label"> 이용 금액</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control">
                    </div>
                  </div>
                  <button type="button" class="btn btn-theme04">취소</button>
                  <button type="button" class="btn btn-theme">가입하기</button>
                </form>
              </div>
            </div>
            <!-- col-lg-12-->
          </div>
          <!-- /row -->
        </div>
        <!-- /row mt -->
      </section>
    </section>
  </section>
  <script src="../js/jquery.js"></script>
  <script src="../js/jquery-1.8.3.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>
  <script class="include" type="text/javascript"
    src="../js/jquery.dcjqaccordion.2.7.js"></script>
  <script src="../js/jquery.scrollTo.min.js"></script>
  <script src="../js/jquery.nicescroll.js" type="text/javascript"></script>
  <script src="../js/jquery.sparkline.js"></script>
  <script src="../js/common-scripts.js"></script>
    <script type="text/javascript"
		src="//apis.daum.net/maps/maps3.js?apikey=90d863ade026cac74762f5c9d8c37284"></script>
  <script>
  $('#map1').css('display', 'none');
  var markers = [];
  var mapContainer = document.getElementById('map1'), // 지도를 표시할 div 
    mapOption = { 
        center: new daum.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
        level: 3 // 지도의 확대 레벨
    };
  // 지도를 생성.
  var map1 = new daum.maps.Map(mapContainer, mapOption);
  
  //장소 검색 객체를 생성합니다
  var ps = new daum.maps.services.Places(); 
  
  //검색 결과 목록이나 마커를 클릭했을 때 장소명을 표출할 인포윈도우를 생성합니다
  var infowindow = new daum.maps.InfoWindow({zIndex:1});

  // 키워드로 장소를 검색합니다
  searchPlaces();
  
  //키워드 검색을 요청하는 함수입니다
  function searchPlaces() {

      var keyword = document.getElementById('keyword').value;

      if (!keyword.replace(/^\s+|\s+$/g, '')) {
          alert('키워드를 입력해주세요!');
          return false;
      }

      // 장소검색 객체를 통해 키워드로 장소검색을 요청합니다
      ps.keywordSearch( keyword, placesSearchCB); 
  }
  
  //장소검색이 완료됐을 때 호출되는 콜백함수 입니다
  function placesSearchCB(status, data, pagination) {
      if (status === daum.maps.services.Status.OK) {

          // 정상적으로 검색이 완료됐으면
          // 검색 목록과 마커를 표출합니다
          displayPlaces(data.places);

          // 페이지 번호를 표출합니다
          displayPagination(pagination);

      } else if (status === daum.maps.services.Status.ZERO_RESULT) {

          alert('검색 결과가 존재하지 않습니다.');
          return;

      } else if (status === daum.maps.services.Status.ERROR) {

          alert('검색 결과 중 오류가 발생했습니다.');
          return;

      }
  }

  // 검색 결과 목록과 마커를 표출하는 함수입니다
  function displayPlaces(places) {

      var listEl = document.getElementById('placesList'), 
      menuEl = document.getElementById('menu_wrap'),
      fragment = document.createDocumentFragment(), 
      bounds = new daum.maps.LatLngBounds(), 
      listStr = '';
      
      // 검색 결과 목록에 추가된 항목들을 제거합니다
      removeAllChildNods(listEl);

      // 지도에 표시되고 있는 마커를 제거합니다
      removeMarker();
      
      for ( var i=0; i<places.length; i++ ) {

          // 마커를 생성하고 지도에 표시합니다
          var placePosition = new daum.maps.LatLng(places[i].latitude, places[i].longitude),
              marker = addMarker(placePosition, i), 
              itemEl = getListItem(i, places[i], marker); // 검색 결과 항목 Element를 생성합니다

          // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
          // LatLngBounds 객체에 좌표를 추가합니다
          bounds.extend(placePosition);

          // 마커와 검색결과 항목에 mouseover 했을때
          // 해당 장소에 인포윈도우에 장소명을 표시합니다
          // mouseout 했을 때는 인포윈도우를 닫습니다
          (function(marker, title) {
              daum.maps.event.addListener(marker, 'mouseover', function() {
                  displayInfowindow(marker, title);
              });

              daum.maps.event.addListener(marker, 'mouseout', function() {
                  infowindow.close();
              });

              itemEl.onmouseover =  function () {
                  displayInfowindow(marker, title);
              };

              itemEl.onmouseout =  function () {
                  infowindow.close();
              };
          })(marker, places[i].title);

          fragment.appendChild(itemEl);
      }

      // 검색결과 항목들을 검색결과 목록 Elemnet에 추가합니다
      listEl.appendChild(fragment);
      menuEl.scrollTop = 0;

      // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
      map.setBounds(bounds);
  }

  // 검색결과 항목을 Element로 반환하는 함수입니다
  function getListItem(index, places) {

      var el = document.createElement('li'),
      itemStr = '<span class="markerbg marker_' + (index+1) + '"></span>' +
                  '<div class="info">' +
                  '   <h5>' + places.title + '</h5>';

      if (places.newAddress) {
          itemStr += '    <span>' + places.newAddress + '</span>' +
                      '   <span class="jibun gray">' +  places.address  + '</span>';
      } else {
          itemStr += '    <span>' +  places.address  + '</span>'; 
      }
                   
        itemStr += '  <span class="tel">' + places.phone  + '</span>' +
                  '</div>';           

      el.innerHTML = itemStr;
      el.className = 'item';

      return el;
  }

  // 마커를 생성하고 지도 위에 마커를 표시하는 함수입니다
  function addMarker(position, idx, title) {
      var imageSrc = 'http://i1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png', // 마커 이미지 url, 스프라이트 이미지를 씁니다
          imageSize = new daum.maps.Size(36, 37),  // 마커 이미지의 크기
          imgOptions =  {
              spriteSize : new daum.maps.Size(36, 691), // 스프라이트 이미지의 크기
              spriteOrigin : new daum.maps.Point(0, (idx*46)+10), // 스프라이트 이미지 중 사용할 영역의 좌상단 좌표
              offset: new daum.maps.Point(13, 37) // 마커 좌표에 일치시킬 이미지 내에서의 좌표
          },
          markerImage = new daum.maps.MarkerImage(imageSrc, imageSize, imgOptions),
              marker = new daum.maps.Marker({
              position: position, // 마커의 위치
              image: markerImage 
          });

      marker.setMap(map); // 지도 위에 마커를 표출합니다
      markers.push(marker);  // 배열에 생성된 마커를 추가합니다

      return marker;
  }

  // 지도 위에 표시되고 있는 마커를 모두 제거합니다
  function removeMarker() {
      for ( var i = 0; i < markers.length; i++ ) {
          markers[i].setMap(null);
      }   
      markers = [];
  }

  // 검색결과 목록 하단에 페이지번호를 표시는 함수입니다
  function displayPagination(pagination) {
      var paginationEl = document.getElementById('pagination'),
          fragment = document.createDocumentFragment(),
          i; 

      // 기존에 추가된 페이지번호를 삭제합니다
      while (paginationEl.hasChildNodes()) {
          paginationEl.removeChild (paginationEl.lastChild);
      }

      for (i=1; i<=pagination.last; i++) {
          var el = document.createElement('a');
          el.href = "#";
          el.innerHTML = i;

          if (i===pagination.current) {
              el.className = 'on';
          } else {
              el.onclick = (function(i) {
                  return function() {
                      pagination.gotoPage(i);
                  }
              })(i);
          }

          fragment.appendChild(el);
      }
      paginationEl.appendChild(fragment);
  }

  // 검색결과 목록 또는 마커를 클릭했을 때 호출되는 함수입니다
  // 인포윈도우에 장소명을 표시합니다
  function displayInfowindow(marker, title) {
      var content = '<div style="padding:5px;z-index:1;">' + title + '</div>';

      infowindow.setContent(content);
      infowindow.open(map, marker);
  }

   // 검색결과 목록의 자식 Element를 제거하는 함수입니다
  function removeAllChildNods(el) {   
      while (el.hasChildNodes()) {
          el.removeChild (el.lastChild);
      }
  }
  </script>
  <script>
    function layout() {
    	  map1.relayout();  
    	  $('#map1').css('display', '');
      map1.relayout();
    }
    
    function search() {
    	  $.ajax({
    		  url : contextRoot + '/info/ajax/searchSchool.do',
    		  type : 'post',
    		  dataType : 'json',
    		  cache : false,
    		  success : function (resultObj) {
    			  console.log(resultObj);
    		  }
    	  })
    }
    
    function logout() {
      $.ajax({
        url : contextRoot + '/auth/ajax/logout.do',
        type : 'post',
        dataType : 'json',
        cache : false,
        success : function(resultObj) {
          var ajaxresult = resultObj.AjaxResult;
          if (ajaxresult.status == 'success') {
            location.replace("http://localhost:8080/wecando/login.html");
          } else {
            sweetAlert("Oops...", "Logout에 실패하였습니다.","error");
          }
        }
      })
    }

    function join() {
      location.replace("http://localhost:8080/wecando/loginpage/auth.html");
    }

    function login() {
      var form_data = new FormData();
      form_data.append("m_email", $('#m_email').val());
      form_data.append("m_password", $('#m_password').val());
      $.ajax({
         url : contextRoot + '/auth/ajax/login.do',
         type : 'post',
         dataType : 'json',
         cache : false,
         contentType : false,
         processData : false,
         data : form_data,
         success : function(resultObj) {
           var ajaxResult = resultObj;
           if (ajaxResult.status == 'success') {
             location
                 .replace("http://localhost:8080/wecando/wecando.html");
           } else {
             sweetAlert("Oops...",
                 "아이디 또는 비밀번호가 일치하지 않습니다.", "error");
           }
         },
         error : function(resultObj) {
           sweetAlert("Oops...", "아이디 또는 비밀번호가 일치하지 않습니다.",
               "error");
         }
       })
    }
  </script>
</body>
</html>

