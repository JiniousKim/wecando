<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="java76.pms.dao.SchEventDao">
  <resultMap type="SchEvent" id="scheventMap">
    <id column="event_date" property="schevent_date"/>
    <result column="event_code" property="event_code"/>
    <result column="court_code" property="court_code" />
    <result column="sch_location" property="sch_location" />
    <result column="member_num" property="m_no" />
    <result column="T6_8" property="T6_8" />
    <result column="T8_10" property="T8_10" />
    <result column="T10_12" property="T10_12" />
    <result column="T12_14" property="T12_14" />
    <result column="T14_16" property="T14_16" />
    <result column="T16_18" property="T16_18" />
    <result column="T18_20" property="T18_20" />
    <result column="T20_22" property="T20_22" />
  </resultMap>
  
  <insert id="createTime" parameterType='map'>
    insert into SCHEVENT(court_code, event_code, sch_num, event_date)
    values(#{court_code, jdbcType=VARCHAR}, #{event_code, jdbcType=VARCHAR},
           #{sch_num}, TO_DATE(#{event_date}, "YYYY-MM-DD"))
  </insert>
  
  <select id="schEventList" parameterType='map' resultType='SchEvent'>
    SELECT * 
    FROM (
    SELECT A.*,
           ROWNUM AS RNUM,
           COUNT(*) OVER() AS TOTCNT
    FROM (
         SELECT TO_CHAR(event_date, 'YYYY-MM-DD') as event_date,
		            T6_8       as T6_8,
			          T8_10      as T8_10,
		            T10_12     as T10_12,
		            T12_14     as T12_14,
		            T14_16     as T14_16,
		            T16_18     as T16_18,
		            T18_20     as T18_20,
		            T20_22     as T20_22,
		            event_code as event_code,
		            court_code as court_code,
		            sch_num    as sch_num,
		            court_price as court_price,
		            sch_location as sch_location,
		            sch_name   as sch_name,
		            court_cnt  as court_cnt,
		            sch_tel    as sch_tel,
		            event_name as event_name
         FROM SCHEVENT natural left outer join court natural left outer join school
         where event_date = TO_DATE(#{event_date}, 'YYYY-MM-DD') AND 
               event_code = #{event_code} AND sch_location like '%' || #{gu_name} || '%'
    ) A
    ) WHERE
    RNUM > #{startIndex} AND #{endIndex} >= RNUM
    
  </select>
  
  <select id="schEventCnt">
    select count(*)
    from SCHEVNET
  </select>
  
  <select id="searchSchEvent" parameterType='map' resultType="SchEvent">
    select sch_name     as sch_name,
           court_code   as court_code,
           T6_8         as T6_8,
           T8_10        as T8_10,
           T10_12       as T10_12,
           T12_14       as T12_14,
           T14_16       as T14_16,
           T16_18       as T16_18,
           T18_20       as T18_20,
           T20_22       as T20_22,
           court_price  as court_price,
           event_code   as event_code,
           sch_location as sch_location,
           sch_tel      as sch_tel,
           court_cnt    as court_cnt,
           TO_CHAR(event_date, 'YYYY-MM-DD') as event_date,
           sch_num      as sch_num
    from SCHEVENT natural left outer join court natural left outer join school
    where event_code = #{event_code} and 
          sch_num = #{sch_num} and 
          event_date = TO_DATE(#{event_date}, 'YYYY-MM-DD')
  </select>
  
</mapper>